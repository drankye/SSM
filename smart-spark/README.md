# Adapted from Apache Spark 2.2.0 release